{"version":3,"file":"mathjax-angular.js","sources":["../../../projects/mathjax-lib/src/models.ts","../../../projects/mathjax-lib/src/utils.ts","../../../projects/mathjax-lib/src/directive/mathjax.directive.ts","../../../projects/mathjax-lib/src/directive/mathjax.module.ts","../../../projects/mathjax-lib/src/directive/index.ts","../../../projects/mathjax-lib/src/public-api.ts","../../../projects/mathjax-lib/src/mathjax-angular.ts"],"sourcesContent":["/**\n * more complex matjax content wich suppor latex and mathml seperately\n * will be considered for future development\n */\nexport interface MathjaxContent {\n  latex?: string;\n  mathml?: string;\n}\n/**\n * will help to check if expression is valid majax or not\n */\nexport const isMathjaxRegExp = /(?:\\$|\\\\\\(|\\\\\\[|\\\\begin\\{.*?})/;\n//export const isMathJax = /(?:(?:^|[-+_*/])(?:\\s*-?\\d+(\\.\\d+)?(?:[eE][+-]?\\d+)?\\s*))+$/;\n//\nexport const mathjax_url =\n  'https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/startup.js';\n\n/**\n * config - http://docs.mathjax.org/en/latest/web/configuration.html#configuring-and-loading-mathjax\n */\nexport const MathjaxDefaultConfig = {\n  loader: {\n    load: ['output/svg', '[tex]/require', '[tex]/ams'],\n  },\n  tex: {\n    inlineMath: [['$', '$']],\n    //displayMath: [['$$', '$$']],\n    packages: ['base', 'require', 'ams'],\n  },\n  svg: { fontCache: 'global' },\n};\n/**\n * config - http://docs.mathjax.org/en/latest/web/configuration.html#configuring-and-loading-mathjax\n * src - cdn url to js\n */\nexport class RootMathjaxConfig {\n  config?: { [name: string]: any };\n  src?: string;\n}\n","//\n\nimport { isMathjaxRegExp, MathjaxContent } from './models';\n\n//\nexport const isMathjax = (expression: string): boolean =>\n  !!expression?.match(isMathjaxRegExp);\n\n//\n/**\n * find and return mathjax string from input\n * @param expressions\n * @returns mathjax string\n */\nexport const getMathjaxContent = (\n  expressions: MathjaxContent | string\n): string => {\n  if (!expressions) return '';\n  else if ('string' === typeof expressions) return expressions as string;\n  else return expressions.latex ?? expressions.mathml ?? '';\n};\n/**\n * used to fix few issues with mathjax string in angular\n * @param  {string} jax mathjax string\n * @returns {string} fixed string\n */\nexport const fixMathjaxBugs = (jax: string): string => {\n  return (\n    jax\n      //line break error\n      .replace(/<br \\/>/gi, '<br/> ')\n      //automatic breakline\n      .replace(/[$]([\\s\\S]+?)[$]/gi, (m, p: string, o, s) => {\n        //return /s/gi.test(p)\n        return p.includes('\\\\\\\\') && !p.includes('\\\\begin')\n          ? `$\\\\begin{align*}${p}\\\\end{align*}$`\n          : `$${p}$`;\n      })\n  );\n};\n","import {\n  Directive,\n  ElementRef,\n  Input,\n  OnChanges,\n  SimpleChanges,\n} from '@angular/core';\nimport { fixMathjaxBugs, getMathjaxContent, isMathjax } from '../utils';\nimport { MathjaxContent } from '../models';\n\n@Directive({\n  selector: 'mathjax,[mathjax]',\n})\nexport class MathjaxDirective implements OnChanges {\n  //\n  private mathJaxExpressions?: MathjaxContent | string;\n  //\n  private readonly element: HTMLElement;\n  //\n  @Input('mathjax')\n  set mathjax(val: MathjaxContent | string) {\n    this.mathJaxExpressions = val;\n  }\n  //\n  constructor(private el: ElementRef) {\n    //\n    this.element = el.nativeElement;\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const expressions = changes.mathjax;\n    if (\n      !expressions ||\n      expressions.currentValue === expressions.previousValue\n    ) {\n      return;\n    }\n    //\n    const value = getMathjaxContent(expressions.currentValue) + '';\n    //\n    if (isMathjax(value)) {\n      const filteredVal = fixMathjaxBugs(value);\n      this.typeset(() => {\n        this.element.innerHTML = `<div class='jax-process'>${filteredVal}</div>`;\n      });\n    } else {\n      this.element.innerHTML = value;\n    }\n  }\n\n  private typeset(code: () => void) {\n    if (MathJax?.startup) {\n      MathJax.startup.promise = MathJax.startup.promise\n        .then(() => {\n          code();\n          return MathJax.typesetPromise ? MathJax.typesetPromise() : null;\n        })\n        .catch((err: Error) =>\n          console.error('MathJax Typeset failed: ' + err.message)\n        );\n      return MathJax.startup.promise;\n    } else {\n      code();\n    }\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { MathjaxDirective } from './mathjax.directive';\nimport {\n  MathjaxDefaultConfig,\n  mathjax_url,\n  RootMathjaxConfig,\n} from '../models';\n\n@NgModule({\n  declarations: [MathjaxDirective],\n  exports: [MathjaxDirective],\n})\nexport class MathjaxModule {\n  constructor(private moduleConfig: RootMathjaxConfig) {\n    //\n    this.addConfigToDocument();\n    //\n    this.addMatjaxToDocument();\n  }\n\n  private addConfigToDocument() {\n    const tagId = 'mathjax-config-script';\n    const isScript = document.getElementById(tagId);\n    if (isScript) return;\n    //\n    const providConfig = {\n      ...MathjaxDefaultConfig,\n      ...(this.moduleConfig?.config ?? {}),\n    };\n    const script = document.createElement('script') as HTMLScriptElement;\n    script.id = tagId;\n    script.type = 'text/javascript';\n    script.text = `MathJax = ${JSON.stringify(providConfig)}`;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n\n  private addMatjaxToDocument() {\n    const tagId = 'mathjax-script';\n    const isScript = document.getElementById(tagId);\n    if (isScript) return;\n    //\n    const script = document.createElement('script') as HTMLScriptElement;\n    script.id = tagId;\n    script.type = 'text/javascript';\n    script.src = this.moduleConfig?.src ?? mathjax_url;\n    script.async = true;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n\n  public static forRoot(\n    config?: RootMathjaxConfig\n  ): ModuleWithProviders<MathjaxModule> {\n    return {\n      ngModule: MathjaxModule,\n      providers: [{ provide: RootMathjaxConfig, useValue: config ?? {} }],\n    };\n  }\n  public static forChild(): ModuleWithProviders<MathjaxModule> {\n    return {\n      ngModule: MathjaxModule,\n    };\n  }\n}\n","//\nimport { MathjaxModule } from './mathjax.module';\n//\nexport * from './mathjax.directive';\nexport * from './mathjax.module';\n//\nexport default MathjaxModule;\n","/*\n * Public API Surface of mathjax-lib\n */\nexport * as MathJaxUtils from './utils';\nexport * from './directive';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}