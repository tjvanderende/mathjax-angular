{"version":3,"file":"mathjax-angular.umd.js","sources":["../../../projects/mathjax-lib/src/models.ts","../../../projects/mathjax-lib/src/utils.ts","../../../projects/mathjax-lib/src/directive/mathjax.directive.ts","../../../projects/mathjax-lib/src/directive/mathjax.module.ts","../../../projects/mathjax-lib/src/directive/index.ts","../../../projects/mathjax-lib/src/mathjax-angular.ts"],"sourcesContent":["/**\n * more complex matjax content wich suppor latex and mathml seperately\n * will be considered for future development\n */\nexport interface MathjaxContent {\n  latex?: string;\n  mathml?: string;\n}\n/**\n * will help to check if expression is valid majax or not\n */\nexport const isMathjaxRegExp = /(?:\\$|\\\\\\(|\\\\\\[|\\\\begin\\{.*?})/;\n//export const isMathJax = /(?:(?:^|[-+_*/])(?:\\s*-?\\d+(\\.\\d+)?(?:[eE][+-]?\\d+)?\\s*))+$/;\n//\nexport const mathjax_url =\n  'https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/startup.js';\n\n/**\n * config - http://docs.mathjax.org/en/latest/web/configuration.html#configuring-and-loading-mathjax\n */\nexport const MathjaxDefaultConfig = {\n  loader: {\n    load: ['output/svg', '[tex]/require', '[tex]/ams'],\n  },\n  tex: {\n    inlineMath: [['$', '$']],\n    //displayMath: [['$$', '$$']],\n    packages: ['base', 'require', 'ams'],\n  },\n  svg: { fontCache: 'global' },\n};\n/**\n * config - http://docs.mathjax.org/en/latest/web/configuration.html#configuring-and-loading-mathjax\n * src - cdn url to js\n */\nexport class RootMathjaxConfig {\n  config?: { [name: string]: any };\n  src?: string;\n}\n","//\n\nimport { isMathjaxRegExp, MathjaxContent } from './models';\n\n//\nexport const isMathjax = (expression: string): boolean =>\n  !!expression?.match(isMathjaxRegExp);\n\n//\n/**\n * find and return mathjax string from input\n * @param expressions\n * @returns mathjax string\n */\nexport const getMathjaxContent = (\n  expressions: MathjaxContent | string\n): string => {\n  if (!expressions) return '';\n  else if ('string' === typeof expressions) return expressions as string;\n  else return expressions.latex ?? expressions.mathml ?? '';\n};\n/**\n * used to fix few issues with mathjax string in angular\n * @param  {string} jax mathjax string\n * @returns {string} fixed string\n */\nexport const fixMathjaxBugs = (jax: string): string => {\n  return (\n    jax\n      //line break error\n      .replace(/<br \\/>/gi, '<br/> ')\n      //automatic breakline\n      .replace(/[$]([\\s\\S]+?)[$]/gi, (m, p: string, o, s) => {\n        //return /s/gi.test(p)\n        return p.includes('\\\\\\\\') && !p.includes('\\\\begin')\n          ? `$\\\\begin{align*}${p}\\\\end{align*}$`\n          : `$${p}$`;\n      })\n  );\n};\n","import {\n  Directive,\n  ElementRef,\n  Input,\n  OnChanges,\n  SimpleChanges,\n} from '@angular/core';\nimport { fixMathjaxBugs, getMathjaxContent, isMathjax } from '../utils';\nimport { MathjaxContent } from '../models';\n\n@Directive({\n  selector: 'mathjax,[mathjax]',\n})\nexport class MathjaxDirective implements OnChanges {\n  //\n  private mathJaxExpressions?: MathjaxContent | string;\n  //\n  private readonly element: HTMLElement;\n  //\n  @Input('mathjax')\n  set mathjax(val: MathjaxContent | string) {\n    this.mathJaxExpressions = val;\n  }\n  //\n  constructor(private el: ElementRef) {\n    //\n    this.element = el.nativeElement;\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const expressions = changes.mathjax;\n    if (\n      !expressions ||\n      expressions.currentValue === expressions.previousValue\n    ) {\n      return;\n    }\n    //\n    const value = getMathjaxContent(expressions.currentValue) + '';\n    //\n    if (isMathjax(value)) {\n      const filteredVal = fixMathjaxBugs(value);\n      this.typeset(() => {\n        this.element.innerHTML = `<div class='jax-process'>${filteredVal}</div>`;\n      });\n    } else {\n      this.element.innerHTML = value;\n    }\n  }\n\n  private typeset(code: () => void) {\n    if (MathJax?.startup) {\n      MathJax.startup.promise = MathJax.startup.promise\n        .then(() => {\n          code();\n          return MathJax.typesetPromise ? MathJax.typesetPromise() : null;\n        })\n        .catch((err: Error) =>\n          console.error('MathJax Typeset failed: ' + err.message)\n        );\n      return MathJax.startup.promise;\n    } else {\n      code();\n    }\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { MathjaxDirective } from './mathjax.directive';\nimport {\n  MathjaxDefaultConfig,\n  mathjax_url,\n  RootMathjaxConfig,\n} from '../models';\n\n@NgModule({\n  declarations: [MathjaxDirective],\n  exports: [MathjaxDirective],\n})\nexport class MathjaxModule {\n  constructor(private moduleConfig: RootMathjaxConfig) {\n    //\n    this.addConfigToDocument();\n    //\n    this.addMatjaxToDocument();\n  }\n\n  private addConfigToDocument() {\n    const tagId = 'mathjax-config-script';\n    const isScript = document.getElementById(tagId);\n    if (isScript) return;\n    //\n    const providConfig = {\n      ...MathjaxDefaultConfig,\n      ...(this.moduleConfig?.config ?? {}),\n    };\n    const script = document.createElement('script') as HTMLScriptElement;\n    script.id = tagId;\n    script.type = 'text/javascript';\n    script.text = `MathJax = ${JSON.stringify(providConfig)}`;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n\n  private addMatjaxToDocument() {\n    const tagId = 'mathjax-script';\n    const isScript = document.getElementById(tagId);\n    if (isScript) return;\n    //\n    const script = document.createElement('script') as HTMLScriptElement;\n    script.id = tagId;\n    script.type = 'text/javascript';\n    script.src = this.moduleConfig?.src ?? mathjax_url;\n    script.async = true;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n\n  public static forRoot(\n    config?: RootMathjaxConfig\n  ): ModuleWithProviders<MathjaxModule> {\n    return {\n      ngModule: MathjaxModule,\n      providers: [{ provide: RootMathjaxConfig, useValue: config ?? {} }],\n    };\n  }\n  public static forChild(): ModuleWithProviders<MathjaxModule> {\n    return {\n      ngModule: MathjaxModule,\n    };\n  }\n}\n","//\nimport { MathjaxModule } from './mathjax.module';\n//\nexport * from './mathjax.directive';\nexport * from './mathjax.module';\n//\nexport default MathjaxModule;\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["Directive","Input","NgModule"],"mappings":"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"}